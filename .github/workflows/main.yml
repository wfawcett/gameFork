name: Build project

on:
  pull_request: {}
  push: { branches: [master] }

env:
  UNITY_LICENSE: <?xml version="1.0" encoding="UTF-8"?><root><License id="Terms"><MachineBindings><Binding Key="1" Value="6267ea9fc7d14500aa807ed66206ac99"/><Binding Key="2" Value="6267ea9fc7d14500aa807ed66206ac99"/></MachineBindings><MachineID Value="MCH/Y70G7ChsNMj5QvHbxkY3lyQ="/><SerialHash Value="e3180ec9c2ebe688e6a1c28e13aa56c7bf98af73"/><Features><Feature Value="33"/><Feature Value="1"/><Feature Value="12"/><Feature Value="2"/><Feature Value="24"/><Feature Value="3"/><Feature Value="36"/><Feature Value="17"/><Feature Value="19"/><Feature Value="62"/></Features><DeveloperData Value="AQAAAEY0LU5BVlktOEYzUi1TQ1dCLVZERDQtRkNIRQ=="/><SerialMasked Value="F4-NAVY-8F3R-SCWB-VDD4-XXXX"/><StartDate Value="2019-09-07T00:00:00"/><UpdateDate Value="2020-02-01T21:40:14"/><InitialActivationDate Value="2019-09-07T22:48:54"/><LicenseVersion Value="6.x"/><ClientProvidedVersion Value="2018.4.15f1"/><AlwaysOnline Value="false"/><Entitlements><Entitlement Ns="unity_editor" Tag="UnityPersonal" Type="EDITOR" ValidTo="9999-12-31T00:00:00"/></Entitlements></License><Signature xmlns="http://www.w3.org/2000/09/xmldsig#"><SignedInfo><CanonicalizationMethod Algorithm="http://www.w3.org/TR/2001/REC-xml-c14n-20010315#WithComments"/><SignatureMethod Algorithm="http://www.w3.org/2000/09/xmldsig#rsa-sha1"/><Reference URI="#Terms"><Transforms><Transform Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/></Transforms><DigestMethod Algorithm="http://www.w3.org/2000/09/xmldsig#sha1"/><DigestValue>uoemqbw3fhKo5w8rbYQ4O+y2e/Y=</DigestValue></Reference></SignedInfo><SignatureValue>NEYPTNjl/Aaba0w1y4uJIg/aS3CV8OypIThNOFFRxqBQd0Rkr9FOZXfiKNFCjOylpe6Kz946Q6SsMFXx4WaLdMc0AwNGuzQbOKQpU/TvypHcpa9WRRF9ADyBJ20BMmDj0x+X2mWWmAuiDNuJr9Nn/LxfIAerbNoSaIYe8WBNtal69KkN5PO32QbaRVw2R62vVcizF4LzC5pHIp5lGx2zh8e2t4C1Ngb00nIjERsMfxtMnUlykyyHwhU4Y6gPvtrmoK+McQ2qnSaPmwbEH6qBoNxxjK83sG8XjZfdkmviXgGHPJmssSnki6ZwCzeNGqhjT6fhCVxXWpxQdFnBu7RifA==</SignatureValue></Signature></root>

jobs:
  requestManualActivationFile:
    name: Request manual activation file ðŸ”‘
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
        
    steps:
      # Checkout repository (required to test local actions)
      - name: Checkout repository
        uses: actions/checkout@v1

      # Request manual activation file
      - name: Request manual activation file
        id: getManualLicenseFile
        uses: webbertakken/unity-request-manual-activation-file@v1.1
        with:
          unityVersion: 2018.4.15f1

      # Upload artifact (Unity_v20XX.X.XXXX.alf)
      - name: Expose as artifact
        uses: actions/upload-artifact@v1
        with:
          name: ${{ steps.getManualLicenseFile.outputs.filePath }}
          path: ${{ steps.getManualLicenseFile.outputs.filePath }}
   
  testAllModes:
    name: Test in ${{ matrix.testMode }} on version ${{ matrix.unityVersion }}
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        projectPath:
          - ./
        unityVersion:
          - 2018.4.15f1
        testMode:
          - playmode          
    steps:
      - uses: actions/checkout@v2
        with:
          lfs: true
      - uses: actions/cache@v1.1.0
        with:
          path: ${{ matrix.projectPath }}/Library
          key: Library-${{ matrix.projectPath }}
          restore-keys: |
            Library-
      - uses: webbertakken/unity-test-runner@v1.2
        id: tests
        with:
          projectPath: ${{ matrix.projectPath }}
          unityVersion: ${{ matrix.unityVersion }}
          testMode: ${{ matrix.testMode }}
          artifactsPath: ${{ matrix.testMode }}-artifacts
      - uses: actions/upload-artifact@v1
        with:
          name: Test results for ${{ matrix.testMode }}
          path: ${{ steps.tests.outputs.artifactsPath }}

